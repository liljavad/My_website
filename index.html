<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root {
      --transition-speed: 0.4s;
      --mouse-x: 50%;
      --mouse-y: 50%;
    }
    body.theme-light {
      --surface: rgba(255, 255, 255, 0.6); --primary: #7B68EE;
      --text-primary: #1F2937; --text-secondary: #6B7280; --shadow-color: rgba(217, 222, 235, 0.7);
      --input-bg: #F9FAFB; --input-border: #F3F4F6; --particle-color-rgb: 123, 104, 238;
      --strength-weak: #EF4444; --strength-medium: #F97316; --strength-strong: #22C55E;
      --aurora-1: hsl(231, 85%, 95%); --aurora-2: hsl(263, 85%, 95%); --aurora-3: hsl(314, 85%, 95%);
    }
    body.theme-dark {
      --surface: rgba(31, 41, 55, 0.5); --primary: #818CF8;
      --text-primary: #F9FAFB; --text-secondary: #9CA3AF; --shadow-color: rgba(0,0,0,0.3);
      --input-bg: #374151; --input-border: #4B5563; --particle-color-rgb: 129, 140, 248;
      --strength-weak: #F87171; --strength-medium: #FB923C; --strength-strong: #4ADE80;
      --aurora-1: hsl(231, 45%, 15%); --aurora-2: hsl(263, 45%, 15%); --aurora-3: hsl(314, 45%, 15%);
    }
    body {
      font-family: 'Poppins', sans-serif; color: var(--text-primary);
      background-color: var(--aurora-1); display: flex; align-items: center; justify-content: center; min-height: 100vh;
      padding: 1rem; transition: background-color var(--transition-speed), color var(--transition-speed); overflow: hidden; position: relative;
    }
    
    body.aurora-enabled::before {
        content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background-image: 
            radial-gradient(circle at var(--mouse-x) var(--mouse-y), hsla(0, 0%, 100%, 0.1), transparent 20vmax),
            radial-gradient(circle at 10% 20%, var(--aurora-2), transparent 25vmax),
            radial-gradient(circle at 90% 30%, var(--aurora-3), transparent 25vmax),
            radial-gradient(circle at 50% 90%, var(--aurora-1), transparent 25vmax);
        mix-blend-mode: screen; animation: aurora-anim 20s linear infinite;
        will-change: background-image; z-index: -2;
    }
    @keyframes aurora-anim { from { background-position: 0% 50%, 0% 0%, 0% 0%, 0% 0%; } to { background-position: 0% 50%, 20% 20%, -20% -20%, 0% 0%; } }

    #particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
    
    .theme-switcher { position: fixed; top: 20px; right: 20px; width: 44px; height: 44px; background-color: var(--surface); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 15px var(--shadow-color); transition: all var(--transition-speed); z-index: 100; }
    .theme-switcher:hover { transform: translateY(-2px) scale(1.05); box-shadow: 0 8px 20px var(--shadow-color); }
    .theme-switcher i { color: var(--primary); font-size: 1.2rem; position: absolute; transition: opacity 0.2s, transform 0.2s; }
    .theme-switcher .fa-sun { opacity: 0; transform: scale(0); }
    body.theme-dark .fa-sun { opacity: 1; transform: scale(1); }
    body.theme-dark .fa-moon { opacity: 0; transform: scale(0); }
    
    .tilt-enabled .login-container { perspective: 1000px; }
    .tilt-enabled .login-box { transition: transform 0.2s ease-out; will-change: transform; }
    
    .login-container { position: relative; width: 100%; max-width: 350px; }
    .login-box { background-color: var(--surface); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 32px; padding: 40px 30px 30px; box-shadow: 0px 20px 40px -10px var(--shadow-color); text-align: center; overflow: hidden; animation: form-fade-in 1s ease-out forwards; }
    @keyframes form-fade-in { from { opacity: 0; transform: scale(0.95) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }

    .login-box.shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    
    h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; animation: title-anim 1.2s ease-out 0.3s backwards; }
    @keyframes title-anim { from { opacity: 0; transform: translateY(20px) skewX(-10deg); } to { opacity: 1; transform: translateY(0) skewX(0); } }

    .subtitle { color: var(--text-secondary); margin-bottom: 28px; font-size: 0.9rem; }
    .form-group { position: relative; margin-bottom: 20px; }
    .form-input { width: 100%; background-color: var(--input-bg); border: 2px solid var(--input-border); border-radius: 14px; padding: 14px 8px; font-size: 0.95rem; color: var(--text-primary); outline: none; transition: all var(--transition-speed); }
    .input-label { position: absolute; top: 13px; left: 17px; color: var(--text-secondary); pointer-events: none; background-color: var(--input-bg); transform-origin: left; transition: all var(--transition-speed); }
    .form-input:focus { border-color: var(--primary); background-color: var(--surface); }
    .form-input:focus + .input-label { background-color: var(--surface); transform: translateY(-25px) scale(0.85); color: var(--primary); padding: 2px 6px; font-weight: 500; border-radius: 6px; }
    .form-input:not(:placeholder-shown) + .input-label { transform: translateY(-25px) scale(0.85); color: var(--primary); padding: 2px 6px; font-weight: 500; border-radius: 6px; }
    .toggle-btn { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-secondary); z-index: 2; }
    
    .strength-meter { height: 60px; opacity: 0; transition: opacity var(--transition-speed); display: flex; justify-content: center; align-items: center; margin-top: 8px; position: relative; }
    .strength-meter.visible { opacity: 1; }
    .ingredient { position: absolute; top: -20px; left: 50%; width: 20px; height: 20px; opacity: 0; transform-origin: center bottom; }
    .ingredient.drop { animation: drop-in 0.8s ease-in-out forwards; }
    @keyframes drop-in { 0% { opacity: 1; transform: translateY(-20px) translateX(-50%) scale(1.2) rotate(0deg); } 50% { transform: translateY(15px) translateX(-50%) scale(0.8) rotate(180deg); } 100% { opacity: 0; transform: translateY(30px) translateX(-50%) scale(0.5) rotate(360deg); } }
    #potion-cauldron { width: 50px; height: 50px; filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.2)); z-index: 1; }
    #potion-liquid { transition: fill var(--transition-speed) ease; }
    #potion-liquid.bubbling { animation: bubbles 1s infinite ease-in-out; }
    @keyframes bubbles { 0%, 100% { transform-origin: 50% 80%; transform: scale(1); } 50% { transform-origin: 50% 80%; transform: scale(1.05); } }

    #potion-steam { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; z-index: 0; opacity: 0; transition: opacity 0.5s ease-out; }
    #potion-steam.visible { opacity: 0.6; animation: steam-anim 2s infinite linear; }
    @keyframes steam-anim { from { transform: translateX(-50%) translateY(10px) scale(0.8); } to { transform: translateX(-50%) translateY(-20px) scale(1.2); opacity: 0; } }
    .strength-text { text-align: center; font-size: 0.8rem; margin-top: 4px; height: 16px; font-weight: 500; color: var(--text-secondary); transition: color var(--transition-speed); }
    .strength-text.weak { color: var(--strength-weak); } .strength-text.medium { color: var(--strength-medium); } .strength-text.strong { color: var(--strength-strong); }
    
    .submit-btn { width: 100%; padding: 14px; margin-top: 15px; border-radius: 12px; background-image: linear-gradient(45deg, #8A2BE2, #FF1493); background-size: 200%; background-position: left; color: #fff; font-size: 1rem; font-weight: 600; cursor: pointer; border: none; box-shadow: 0 4px 15px rgba(123, 104, 238, 0.4); transition: all var(--transition-speed) ease; }
    .submit-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 7px 20px rgba(255, 20, 147, 0.4); background-position: right; }
    .submit-btn.ready { animation: pulse 2s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 20, 147, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 20, 147, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 20, 147, 0); } }
    .submit-btn.fly-away { animation: fly-away 0.7s ease-in-out forwards; }
    @keyframes fly-away { from { transform: translateY(0) scale(1); opacity: 1; } to { transform: translateY(-150px) scale(0.5); opacity: 0; } }
    
    .social-divider { margin: 20px 0; color: var(--text-secondary); font-size: 0.8rem; }
    .social-logins { display: flex; justify-content: center; gap: 16px; }
    .social-btn { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; background-color: var(--surface); border: 1px solid var(--input-border); border-radius: 50%; color: var(--text-secondary); font-size: 1.1rem; text-decoration: none; }
    .social-btn:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
    .form-footer { margin-top: 24px; font-size: 0.8rem; color: var(--text-secondary); }
    .form-footer a { color: var(--primary); font-weight: 500; text-decoration: none; }

    .settings-panel { position: fixed; bottom: 80px; left: 20px; background: var(--surface); backdrop-filter: blur(10px); border-radius: 16px; padding: 10px; box-shadow: 0 4px 20px var(--shadow-color); z-index: 100; transform: scale(0.95) translateY(20px) ; opacity: 0; pointer-events: none; transition: all 0.3s ease-out; }
    .settings-panel.visible { transform: scale(1) translateY(0); opacity: 1; pointer-events: all; }
    .settings-toggle { position: fixed; bottom: 20px; left: 20px; width: 44px; height: 44px; background: var(--surface); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 101; box-shadow: 0 4px 15px var(--shadow-color); transition: transform 0.2s ease-out; }
    .settings-toggle:hover { transform: scale(1.1) rotate(45deg); }
    .settings-toggle i { color: var(--primary); }
    .settings-panel .setting { display: flex; align-items: center; margin-bottom: 5px; font-size: 0.9rem; }
    .settings-panel label { margin-left: 8px; cursor: pointer; }

  </style>
</head>
<body class="theme-dark aurora-enabled tilt-enabled">
  
  <canvas id="particle-canvas"></canvas>
  
  <div class="theme-switcher" id="theme-switcher">
    <i class="fas fa-moon"></i>
    <i class="fas fa-sun"></i>
  </div>
  
  <div class="settings-toggle" id="settings-toggle">
    <i class="fas fa-cog"></i>
  </div>
  <div class="settings-panel" id="settings-panel">
      <div class="setting">
          <input type="checkbox" id="aurora-toggle" checked>
          <label for="aurora-toggle">Aurora Effect</label>
      </div>
      <div class="setting">
          <input type="checkbox" id="tilt-toggle" checked>
          <label for="tilt-toggle">3D Tilt Effect</label>
      </div>
  </div>

  <div class="login-container" id="login-container">
      <div class="login-box" id="login-box">
          <h1>Welcome Back!</h1>
          <p class="subtitle">Enter your credentials to continue</p>
          <form id="login-form">
              <div class="form-group">
                  <input type="email" id="email" class="form-input" required placeholder=" ">
                  <label for="email" class="input-label">Email</label>
              </div>
              <div class="form-group" id="password-group">
                  <input type="password" id="password" class="form-input" required placeholder=" ">
                  <label for="password" class="input-label">Password</label>
                  <span class="toggle-btn" onclick="togglePassword(event)"><i id="eye-icon" class="fas fa-eye"></i></span>
              </div>
              
              <div class="strength-meter" id="strength-meter">
                <svg class="ingredient" id="ing-leaf" viewBox="0 0 100 100"><path d="M62.5,23.5c0,0-12.7,11.3-19.8,2.8c-7.1-8.5-1.8-19.8-1.8-19.8S52.2-1.8,62.5,8.5S62.5,23.5,62.5,23.5z" fill="#65C466"/></svg>
                <svg class="ingredient" id="ing-crystal" viewBox="0 0 100 100"><path d="M50,5L65,35L50,95L35,35Z" fill="#8E5AFF"/></svg>
                <svg class="ingredient" id="ing-orb" viewBox="0 0 100 100"><circle cx="50" cy="50" r="20" fill="#F9A825"/></svg>
                <svg class="ingredient" id="ing-sparkle" viewBox="0 0 100 100"><path d="M50,0L61,39L100,50L61,61L50,100L39,61L0,50L39,39Z" fill="#3B82F6"/></svg>
                
                <svg id="potion-steam" viewBox="0 0 100 100"><path d="M 20 80 C 20 60, 40 60, 40 80 S 60 100, 60 80 M 60 80 C 60 60, 80 60, 80 80" stroke="var(--text-secondary)" fill="none" stroke-width="4" stroke-linecap="round"></path></svg>

                <svg id="potion-cauldron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
                  <g fill="var(--text-secondary)">
                    <path d="M 10 30 C 10 20, 90 20, 90 30" stroke="var(--text-secondary)" stroke-width="5" fill="none" />
                    <path d="M 15 32 C 0 50, 0 80, 20 95 L 80 95 C 100 80, 100 50, 85 32 Z" />
                  </g>
                  <path id="potion-liquid" d="M 15 35 C 30 50, 70 50, 85 35 C 85 55, 70 65, 50 65 C 30 65, 15 55, 15 35 Z" fill="transparent"/>
                </svg>
              </div>
              <p class="strength-text" id="strength-text"></p>

              <button type="submit" class="submit-btn" id="submit-btn">Sign In</button>
          </form>
          <div class="social-divider">or</div>
          <div class="social-logins">
              <a href="#" class="social-btn"><i class="fab fa-google"></i></a>
              <a href="#" class="social-btn"><i class="fab fa-github"></i></a>
              <a href="#" class="social-btn"><i class="fab fa-apple"></i></a>
          </div>
          <div class="form-footer"><p>created by <a href="#">Mohamad Javad</a></p></div>
      </div>
  </div>

  <script defer>
    // --- COMPLETE, UNABRIDGED & OPTIMIZED SCRIPT ---

    // --- DOM Element Setup ---
    const body = document.body;
    const loginBox = document.getElementById('login-box');
    const passwordInput = document.getElementById('password');
    const emailInput = document.getElementById('email');
    const strengthMeter = document.getElementById('strength-meter');
    const strengthText = document.getElementById('strength-text');
    const potionLiquid = document.getElementById('potion-liquid');
    const potionSteam = document.getElementById('potion-steam');
    const submitBtn = document.getElementById('submit-btn');
    const canvas = document.getElementById('particle-canvas');
    const ctx = canvas.getContext('2d');

    let particlesArray = [];
    let lastPasswordLength = 0;
    let mouseMoveUpdateQueued = false;

    // --- Mouse Move Handler (Optimized with requestAnimationFrame) ---
    window.addEventListener('mousemove', (e) => {
        if (mouseMoveUpdateQueued) return;
        mouseMoveUpdateQueued = true;
        requestAnimationFrame(() => {
            const { clientX, clientY } = e;
            const { innerWidth, innerHeight } = window;

            if (body.classList.contains('aurora-enabled')) {
                body.style.setProperty('--mouse-x', `${clientX}px`);
                body.style.setProperty('--mouse-y', `${clientY}px`);
            }
            if (body.classList.contains('tilt-enabled')) {
                const yRotation = 10 * ((clientX - innerWidth / 2) / innerWidth);
                const xRotation = -10 * ((clientY - innerHeight / 2) / innerHeight);
                loginBox.style.transform = `rotateY(${yRotation}deg) rotateX(${xRotation}deg)`;
            }
            mouseMoveUpdateQueued = false;
        });
    });

    // --- Theme & Settings Logic ---
    document.getElementById('theme-switcher').addEventListener('click', () => {
        const isDark = body.classList.toggle('theme-dark');
        body.classList.toggle('theme-light', !isDark);
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        setTimeout(initParticles, 50);
    });
    
    const settingsToggle = document.getElementById('settings-toggle');
    const settingsPanel = document.getElementById('settings-panel');
    settingsToggle.addEventListener('click', () => settingsPanel.classList.toggle('visible'));

    const auroraToggle = document.getElementById('aurora-toggle');
    auroraToggle.addEventListener('change', () => body.classList.toggle('aurora-enabled', auroraToggle.checked));

    const tiltToggle = document.getElementById('tilt-toggle');
    tiltToggle.addEventListener('change', () => {
        body.classList.toggle('tilt-enabled', tiltToggle.checked);
        if (!tiltToggle.checked) loginBox.style.transform = '';
    });
    
    function setInitialState() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        body.className = `theme-${savedTheme}`;
        
        const auroraEnabled = localStorage.getItem('aurora-enabled') !== 'false';
        const tiltEnabled = localStorage.getItem('tilt-enabled') !== 'false';
        
        auroraToggle.checked = auroraEnabled;
        tiltToggle.checked = tiltEnabled;

        body.classList.toggle('aurora-enabled', auroraEnabled);
        body.classList.toggle('tilt-enabled', tiltEnabled);
    }
    setInitialState();

    // --- Password Strength & Potion Logic ---
    const strengthLevels = {
        0: { text: "", class: "", color: "transparent" },
        1: { text: "Weak Potion", class: "weak", color: "var(--strength-weak)" },
        2: { text: "Medium Brew", class: "medium", color: "var(--strength-medium)" },
        3: { text: "Ultimate Elixir!", class: "strong", color: "var(--strength-strong)" }
    };

    function updateFormState() {
        const password = passwordInput.value;
        const { strength, newCharType } = checkPasswordStrength(password);
        const level = strengthLevels[strength];

        if (newCharType) animateIngredient(newCharType);

        if (password.length === 0) {
            strengthMeter.classList.remove('visible');
            potionSteam.classList.remove('visible');
        } else {
            strengthMeter.classList.add('visible');
            strengthText.textContent = level.text;
            strengthText.className = `strength-text ${level.class}`;
            potionLiquid.style.fill = level.color;
        }
        
        potionLiquid.classList.toggle('bubbling', strength === 3);
        potionSteam.classList.toggle('visible', strength >= 2);

        const isEmailValid = emailInput.checkValidity();
        submitBtn.classList.toggle('ready', isEmailValid && strength === 3);
    }
    
    passwordInput.addEventListener('input', updateFormState);
    emailInput.addEventListener('input', updateFormState);

    function checkPasswordStrength(password) {
        let score = 0;
        let newCharType = null;
        
        if (password.length > lastPasswordLength) {
            const newChar = password.slice(-1);
            if (/[a-z]/.test(newChar)) newCharType = 'leaf';
            else if (/[A-Z]/.test(newChar)) newCharType = 'crystal';
            else if (/\d/.test(newChar)) newCharType = 'orb';
            else if (/[^A-Za-z0-9]/.test(newChar)) newCharType = 'sparkle';
        }
        lastPasswordLength = password.length;

        if (password.length > 7) score++;
        if (password.length > 10) score++;
        if (/[A-Z]/.test(password) && /[a-z]/.test(password)) score++;
        if (/\d/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        let strength = 0;
        if (score >= 5) strength = 3;
        else if (score >= 3) strength = 2;
        else if (score >= 1) strength = 1;
        
        return { strength, newCharType };
    }

    function animateIngredient(type) {
        const ingredient = document.getElementById(`ing-${type}`);
        if(ingredient) {
            const newIngredient = ingredient.cloneNode(true);
            ingredient.parentNode.replaceChild(newIngredient, ingredient);
            newIngredient.classList.add('drop');
        }
    }

    // --- Form Submission Logic ---
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!submitBtn.classList.contains('ready')) {
            loginBox.classList.add('shake');
            setTimeout(() => loginBox.classList.remove('shake'), 500);
            return;
        }
        submitBtn.classList.add('fly-away');
    });

    // --- Particle System Logic (Optimized) ---
    class Particle {
        constructor(x,y,dirX,dirY,size,color){this.x=x;this.y=y;this.dirX=dirX;this.dirY=dirY;this.size=size;this.color=color;this.twinkleSpeed=Math.random()*0.05+0.01;this.alpha=Math.random();}
        draw(){ctx.beginPath();const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size);g.addColorStop(0,`rgba(255,255,255,${this.alpha*.9})`);g.addColorStop(.4,`rgba(${this.color},${this.alpha*.7})`);g.addColorStop(1,`rgba(${this.color},0)`);ctx.fillStyle=g;ctx.arc(this.x,this.y,this.size,0,Math.PI*2,false);ctx.fill();}
        update(){if(this.x>canvas.width+this.size||this.x<0-this.size)this.dirX=-this.dirX;if(this.y>canvas.height+this.size||this.y<0-this.size)this.dirY=-this.dirY;this.alpha+=this.twinkleSpeed;if(this.alpha>1||this.alpha<0)this.twinkleSpeed*=-1;this.x+=this.dirX;this.y+=this.dirY;this.draw();}
    }
    function initParticles() {
        particlesArray=[];
        let num=(canvas.width*canvas.height)/25000; // Reduced particle count
        let color=getComputedStyle(body).getPropertyValue('--particle-color-rgb').trim();
        for(let i=0;i<num;i++){let size=Math.random()*3+1.5;let x=Math.random()*(innerWidth-size*2)+size;let y=Math.random()*(innerHeight-size*2)+size;let dirX=Math.random()*.2-.1;let dirY=Math.random()*.2-.1;particlesArray.push(new Particle(x,y,dirX,dirY,size,color));}
    }
    function animateParticles() {requestAnimationFrame(animateParticles);ctx.clearRect(0,0,innerWidth,innerHeight);for(let i=0;i<particlesArray.length;i++){particlesArray[i].update();}}
    
    // --- Utility Functions ---
    function setCanvasSize() { canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
    window.addEventListener('resize', ()=>{ setCanvasSize(); initParticles(); });
    function togglePassword(event){event.stopPropagation();const isPassword=passwordInput.type==="password";passwordInput.type=isPassword?"text":"password";document.getElementById('eye-icon').classList.toggle("fa-eye-slash",isPassword);document.getElementById('eye-icon').classList.toggle("fa-eye",!isPassword);}

    // --- Initial Load ---
    setCanvasSize();
    initParticles();
    animateParticles();
  </script>
</body>
</html>
